# Google Analytics & Google Tag Manager è¨­å®šã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€THE LONG GAMEã®ECã‚µã‚¤ãƒˆã«Google Analytics 4ï¼ˆGA4ï¼‰ã¨Google Tag Managerï¼ˆGTMï¼‰ã‚’å°å…¥ã™ã‚‹æ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™ã€‚

### å¯¾è±¡ã‚µã‚¤ãƒˆæ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    THE LONG GAME ECã‚µã‚¤ãƒˆ                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  ã€ä¸€èˆ¬ãƒšãƒ¼ã‚¸ã€‘                        ã€ECæ©Ÿèƒ½ã€‘                          â”‚
â”‚  â”œâ”€â”€ / (ãƒ›ãƒ¼ãƒ )                       â”œâ”€â”€ /shop (å•†å“ä¸€è¦§)                â”‚
â”‚  â”œâ”€â”€ /about (ãƒ–ãƒ©ãƒ³ãƒ‰ç´¹ä»‹)             â”œâ”€â”€ /shop/:slug (å•†å“è©³ç´°)          â”‚
â”‚  â”œâ”€â”€ /details (è©³ç´°)                  â”œâ”€â”€ /cart (ã‚«ãƒ¼ãƒˆ)                  â”‚
â”‚  â”œâ”€â”€ /contact (ãŠå•ã„åˆã‚ã›)           â””â”€â”€ /checkout/success (è³¼å…¥å®Œäº†)    â”‚
â”‚  â”œâ”€â”€ /styling (ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ä¸€è¦§)                                          â”‚
â”‚  â””â”€â”€ /styling/:slug (ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°è©³ç´°)                                    â”‚
â”‚                                                                          â”‚
â”‚  ã€ä¼šå“¡æ©Ÿèƒ½ã€‘                          ã€ç®¡ç†è€…æ©Ÿèƒ½ã€‘                       â”‚
â”‚  â”œâ”€â”€ /login (ãƒ­ã‚°ã‚¤ãƒ³)                 â”œâ”€â”€ /admin (ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰)          â”‚
â”‚  â””â”€â”€ /my-account (ãƒã‚¤ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ)      â”œâ”€â”€ /admin/products (å•†å“ç®¡ç†)       â”‚
â”‚                                       â”œâ”€â”€ /admin/styling (ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ç®¡ç†) â”‚
â”‚                                       â”œâ”€â”€ /admin/orders (æ³¨æ–‡ç®¡ç†)         â”‚
â”‚                                       â”œâ”€â”€ /admin/accounts (ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†)  â”‚
â”‚                                       â””â”€â”€ /admin/analytics (åˆ†æ)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¨ˆæ¸¬ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React App     â”‚â”€â”€â”€â”€â–¶â”‚  Google Tag     â”‚â”€â”€â”€â”€â–¶â”‚  Google         â”‚
â”‚  (dataLayer)    â”‚     â”‚  Manager        â”‚     â”‚  Analytics 4    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â”‚                       â”œâ”€â”€â”€â”€â–¶ Google Ads (å°†æ¥å¯¾å¿œ)
        â”‚                       â””â”€â”€â”€â”€â–¶ ãã®ä»–ã®ãƒ„ãƒ¼ãƒ«
        â”‚
        â””â”€â”€â”€â”€â–¶ Stripeæ±ºæ¸ˆã‚¤ãƒ™ãƒ³ãƒˆé€£æº
```

---

## 1. Google Analytics 4 (GA4) ã®è¨­å®š

### 1.1 GA4 ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ä½œæˆ

1. [Google Analytics](https://analytics.google.com/) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€Œç®¡ç†ã€â†’ã€Œãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½œæˆã€
3. ä»¥ä¸‹ã®æƒ…å ±ã‚’å…¥åŠ›ï¼š
   - **ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å**: THE LONG GAME
   - **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³**: æ—¥æœ¬
   - **é€šè²¨**: æ—¥æœ¬å†† (JPY)
4. ãƒ“ã‚¸ãƒã‚¹æƒ…å ±ã‚’å…¥åŠ›
5. ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ä½œæˆ:
   - **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: ã‚¦ã‚§ãƒ–
   - **URL**: `https://main.d3o5fndieuvuu2.amplifyapp.com`ï¼ˆæœ¬ç•ªURLï¼‰
   - **ã‚¹ãƒˆãƒªãƒ¼ãƒ å**: THE LONG GAME - Web

### 1.2 æ¸¬å®šIDã®å–å¾—

GA4 ç®¡ç†ç”»é¢ã‹ã‚‰ä»¥ä¸‹ã‚’å–å¾—ï¼š
```
æ¸¬å®šID: G-801XNRYDSQ
```

### 1.3 GA4 æ¨å¥¨ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š

GA4 ç®¡ç†ç”»é¢ â†’ ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ  â†’ æ‹¡å¼µè¨ˆæ¸¬æ©Ÿèƒ½ã§ä»¥ä¸‹ã‚’æœ‰åŠ¹åŒ–ï¼š

| æ©Ÿèƒ½ | èª¬æ˜ | æœ‰åŠ¹åŒ– |
|-----|------|-------|
| ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ | ãƒšãƒ¼ã‚¸é–²è¦§ã‚’è¨ˆæ¸¬ | âœ… |
| ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« | 90%ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’è¨ˆæ¸¬ | âœ… |
| é›¢è„±ã‚¯ãƒªãƒƒã‚¯ | å¤–éƒ¨ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯ | âœ… |
| ã‚µã‚¤ãƒˆå†…æ¤œç´¢ | æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’è¨ˆæ¸¬ | âœ… |
| ãƒ•ã‚©ãƒ¼ãƒ ã®æ“ä½œ | ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚’è¨ˆæ¸¬ | âœ… |
| å‹•ç”»ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ | å‹•ç”»å†ç”Ÿã‚’è¨ˆæ¸¬ | âœ… |
| ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ | ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’è¨ˆæ¸¬ | âœ… |

---

## 2. Google Tag Manager (GTM) ã®è¨­å®š

### 2.1 GTM ã‚³ãƒ³ãƒ†ãƒŠã®ä½œæˆ

1. [Google Tag Manager](https://tagmanager.google.com/) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€Œã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã€ã¾ãŸã¯æ—¢å­˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã€Œã‚³ãƒ³ãƒ†ãƒŠã‚’è¿½åŠ ã€
3. ä»¥ä¸‹ã®æƒ…å ±ã‚’å…¥åŠ›ï¼š
   - **ã‚³ãƒ³ãƒ†ãƒŠå**: THE LONG GAME
   - **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: ã‚¦ã‚§ãƒ–
4. ã‚³ãƒ³ãƒ†ãƒŠIDã‚’å–å¾—ï¼š`GTM-KMKK8KZM`

### 2.2 GTM ã‚¹ãƒ‹ãƒšãƒƒãƒˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

`index.html` ã® `<head>` ã‚¿ã‚°å†…ã«è¿½åŠ ï¼š

```html
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-XXXXXXX');</script>
<!-- End Google Tag Manager -->
```

`<body>` ã‚¿ã‚°ç›´å¾Œã«è¿½åŠ ï¼š

```html
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXX"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
```

---

## 3. dataLayer ã®å®Ÿè£…ï¼ˆReactï¼‰

### 3.1 å‹å®šç¾©ã®è¿½åŠ 

`src/types/gtm.d.ts`:

```typescript
interface Window {
  dataLayer: DataLayerEvent[];
  gtag: (...args: any[]) => void;
}

interface DataLayerEvent {
  event?: string;
  ecommerce?: EcommerceData | null;
  [key: string]: any;
}

interface EcommerceData {
  currency?: string;
  value?: number;
  items?: EcommerceItem[];
  transaction_id?: string;
  shipping?: number;
  tax?: number;
}

interface EcommerceItem {
  item_id: string;
  item_name: string;
  item_brand?: string;
  item_category?: string;
  item_variant?: string;
  price: number;
  quantity: number;
  index?: number;
}
```

### 3.2 GTM ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ä½œæˆ

`src/lib/gtm.ts`:

```typescript
/**
 * Google Tag Manager / GA4 ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 */

// dataLayerã®åˆæœŸåŒ–
declare global {
  interface Window {
    dataLayer: any[];
  }
}

// dataLayerã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ—ãƒƒã‚·ãƒ¥
export const pushToDataLayer = (data: Record<string, any>) => {
  window.dataLayer = window.dataLayer || [];
  window.dataLayer.push(data);
};

// Eã‚³ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
export const clearEcommerce = () => {
  pushToDataLayer({ ecommerce: null });
};

// ======================================
// ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼é–¢é€£
// ======================================

export const trackPageView = (pagePath: string, pageTitle: string) => {
  pushToDataLayer({
    event: 'page_view',
    page_path: pagePath,
    page_title: pageTitle,
  });
};

// ======================================
// Eã‚³ãƒãƒ¼ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆGA4æ‹¡å¼µeã‚³ãƒãƒ¼ã‚¹ï¼‰
// ======================================

interface ProductItem {
  item_id: string;
  item_name: string;
  item_brand?: string;
  item_category?: string;
  item_variant?: string;
  price: number;
  quantity?: number;
  index?: number;
}

// å•†å“ä¸€è¦§è¡¨ç¤º
export const trackViewItemList = (
  listName: string,
  items: ProductItem[]
) => {
  clearEcommerce();
  pushToDataLayer({
    event: 'view_item_list',
    ecommerce: {
      item_list_name: listName,
      items: items.map((item, index) => ({
        ...item,
        item_brand: 'THE LONG GAME',
        index: index + 1,
      })),
    },
  });
};

// å•†å“è©³ç´°è¡¨ç¤º
export const trackViewItem = (item: ProductItem) => {
  clearEcommerce();
  pushToDataLayer({
    event: 'view_item',
    ecommerce: {
      currency: 'JPY',
      value: item.price,
      items: [{
        ...item,
        item_brand: 'THE LONG GAME',
        quantity: 1,
      }],
    },
  });
};

// å•†å“ã‚¯ãƒªãƒƒã‚¯
export const trackSelectItem = (
  listName: string,
  item: ProductItem
) => {
  clearEcommerce();
  pushToDataLayer({
    event: 'select_item',
    ecommerce: {
      item_list_name: listName,
      items: [{
        ...item,
        item_brand: 'THE LONG GAME',
      }],
    },
  });
};

// ã‚«ãƒ¼ãƒˆã«è¿½åŠ 
export const trackAddToCart = (
  item: ProductItem,
  quantity: number = 1
) => {
  clearEcommerce();
  pushToDataLayer({
    event: 'add_to_cart',
    ecommerce: {
      currency: 'JPY',
      value: item.price * quantity,
      items: [{
        ...item,
        item_brand: 'THE LONG GAME',
        quantity,
      }],
    },
  });
};

// ã‚«ãƒ¼ãƒˆã‹ã‚‰å‰Šé™¤
export const trackRemoveFromCart = (
  item: ProductItem,
  quantity: number = 1
) => {
  clearEcommerce();
  pushToDataLayer({
    event: 'remove_from_cart',
    ecommerce: {
      currency: 'JPY',
      value: item.price * quantity,
      items: [{
        ...item,
        item_brand: 'THE LONG GAME',
        quantity,
      }],
    },
  });
};

// ã‚«ãƒ¼ãƒˆè¡¨ç¤º
export const trackViewCart = (items: ProductItem[]) => {
  const value = items.reduce(
    (sum, item) => sum + item.price * (item.quantity || 1),
    0
  );
  
  clearEcommerce();
  pushToDataLayer({
    event: 'view_cart',
    ecommerce: {
      currency: 'JPY',
      value,
      items: items.map((item, index) => ({
        ...item,
        item_brand: 'THE LONG GAME',
        index: index + 1,
      })),
    },
  });
};

// ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆé–‹å§‹
export const trackBeginCheckout = (items: ProductItem[]) => {
  const value = items.reduce(
    (sum, item) => sum + item.price * (item.quantity || 1),
    0
  );
  
  clearEcommerce();
  pushToDataLayer({
    event: 'begin_checkout',
    ecommerce: {
      currency: 'JPY',
      value,
      items: items.map((item, index) => ({
        ...item,
        item_brand: 'THE LONG GAME',
        index: index + 1,
      })),
    },
  });
};

// é…é€æƒ…å ±è¿½åŠ 
export const trackAddShippingInfo = (
  items: ProductItem[],
  shippingTier: string = 'é€šå¸¸é…é€'
) => {
  const value = items.reduce(
    (sum, item) => sum + item.price * (item.quantity || 1),
    0
  );
  
  clearEcommerce();
  pushToDataLayer({
    event: 'add_shipping_info',
    ecommerce: {
      currency: 'JPY',
      value,
      shipping_tier: shippingTier,
      items: items.map((item, index) => ({
        ...item,
        item_brand: 'THE LONG GAME',
        index: index + 1,
      })),
    },
  });
};

// æ±ºæ¸ˆæƒ…å ±è¿½åŠ 
export const trackAddPaymentInfo = (
  items: ProductItem[],
  paymentType: string = 'Credit Card'
) => {
  const value = items.reduce(
    (sum, item) => sum + item.price * (item.quantity || 1),
    0
  );
  
  clearEcommerce();
  pushToDataLayer({
    event: 'add_payment_info',
    ecommerce: {
      currency: 'JPY',
      value,
      payment_type: paymentType,
      items: items.map((item, index) => ({
        ...item,
        item_brand: 'THE LONG GAME',
        index: index + 1,
      })),
    },
  });
};

// è³¼å…¥å®Œäº†
export const trackPurchase = (
  transactionId: string,
  items: ProductItem[],
  shipping: number = 0,
  tax: number = 0
) => {
  const value = items.reduce(
    (sum, item) => sum + item.price * (item.quantity || 1),
    0
  );
  
  clearEcommerce();
  pushToDataLayer({
    event: 'purchase',
    ecommerce: {
      transaction_id: transactionId,
      currency: 'JPY',
      value: value + shipping,
      shipping,
      tax,
      items: items.map((item, index) => ({
        ...item,
        item_brand: 'THE LONG GAME',
        index: index + 1,
      })),
    },
  });
};

// ======================================
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆã‚¤ãƒ™ãƒ³ãƒˆ
// ======================================

// ãƒ­ã‚°ã‚¤ãƒ³
export const trackLogin = (method: string = 'email') => {
  pushToDataLayer({
    event: 'login',
    method,
  });
};

// ä¼šå“¡ç™»éŒ²
export const trackSignUp = (method: string = 'email') => {
  pushToDataLayer({
    event: 'sign_up',
    method,
  });
};

// æ¤œç´¢
export const trackSearch = (searchTerm: string) => {
  pushToDataLayer({
    event: 'search',
    search_term: searchTerm,
  });
};

// ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
export const trackContactSubmit = () => {
  pushToDataLayer({
    event: 'generate_lead',
    currency: 'JPY',
    value: 0,
  });
};

// ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°é–²è¦§
export const trackViewStyling = (stylingId: string, stylingName: string) => {
  pushToDataLayer({
    event: 'view_styling',
    styling_id: stylingId,
    styling_name: stylingName,
  });
};

// ======================================
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®š
// ======================================

export const setUserProperties = (
  userId?: string,
  userType?: 'guest' | 'member' | 'admin'
) => {
  pushToDataLayer({
    event: 'set_user_properties',
    user_id: userId,
    user_type: userType,
  });
};
```

### 3.3 å„ãƒšãƒ¼ã‚¸ã¸ã®å®Ÿè£…

#### å•†å“ä¸€è¦§ãƒšãƒ¼ã‚¸ï¼ˆShop.tsxï¼‰

```typescript
import { useEffect } from 'react';
import { trackViewItemList, trackSelectItem } from '../lib/gtm';

// å•†å“ä¸€è¦§ã‚’å–å¾—ã—ãŸå¾Œ
useEffect(() => {
  if (products.length > 0) {
    trackViewItemList('å•†å“ä¸€è¦§', products.map(p => ({
      item_id: p.id,
      item_name: p.name,
      item_category: p.category,
      price: p.price,
    })));
  }
}, [products]);

// å•†å“ã‚¯ãƒªãƒƒã‚¯æ™‚
const handleProductClick = (product: Product) => {
  trackSelectItem('å•†å“ä¸€è¦§', {
    item_id: product.id,
    item_name: product.name,
    item_category: product.category,
    price: product.price,
  });
};
```

#### å•†å“è©³ç´°ãƒšãƒ¼ã‚¸ï¼ˆProductDetail.tsxï¼‰

```typescript
import { useEffect } from 'react';
import { trackViewItem, trackAddToCart } from '../lib/gtm';

// å•†å“è©³ç´°ã‚’å–å¾—ã—ãŸå¾Œ
useEffect(() => {
  if (product) {
    trackViewItem({
      item_id: product.id,
      item_name: product.name,
      item_category: product.category,
      item_variant: selectedSize,
      price: product.price,
    });
  }
}, [product]);

// ã‚«ãƒ¼ãƒˆã«è¿½åŠ æ™‚
const handleAddToCart = () => {
  trackAddToCart({
    item_id: product.id,
    item_name: product.name,
    item_category: product.category,
    item_variant: selectedSize,
    price: product.price,
  }, quantity);
};
```

#### ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ï¼ˆCart.tsxï¼‰

```typescript
import { useEffect } from 'react';
import { trackViewCart, trackRemoveFromCart, trackBeginCheckout } from '../lib/gtm';

// ã‚«ãƒ¼ãƒˆè¡¨ç¤ºæ™‚
useEffect(() => {
  if (cartItems.length > 0) {
    trackViewCart(cartItems.map(item => ({
      item_id: item.product_id,
      item_name: item.product_name,
      item_variant: item.variant_size,
      price: item.price,
      quantity: item.quantity,
    })));
  }
}, [cartItems]);

// å•†å“å‰Šé™¤æ™‚
const handleRemoveItem = (item: CartItem) => {
  trackRemoveFromCart({
    item_id: item.product_id,
    item_name: item.product_name,
    item_variant: item.variant_size,
    price: item.price,
  }, item.quantity);
};

// ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚
const handleCheckout = () => {
  trackBeginCheckout(cartItems.map(item => ({
    item_id: item.product_id,
    item_name: item.product_name,
    item_variant: item.variant_size,
    price: item.price,
    quantity: item.quantity,
  })));
};
```

#### è³¼å…¥å®Œäº†ãƒšãƒ¼ã‚¸ï¼ˆCheckoutSuccess.tsxï¼‰

```typescript
import { useEffect } from 'react';
import { trackPurchase } from '../lib/gtm';

// è³¼å…¥å®Œäº†æ™‚ï¼ˆä¸€åº¦ã ã‘å®Ÿè¡Œï¼‰
useEffect(() => {
  if (orderDetails && sessionId) {
    // é‡è¤‡é€ä¿¡é˜²æ­¢
    const purchaseTracked = sessionStorage.getItem(`purchase_tracked_${sessionId}`);
    if (!purchaseTracked) {
      trackPurchase(
        sessionId,
        orderDetails.items.map(item => ({
          item_id: item.product_id,
          item_name: item.product_name,
          item_variant: item.variant_size,
          price: item.price,
          quantity: item.quantity,
        })),
        orderDetails.shipping || 0,
        orderDetails.tax || 0
      );
      sessionStorage.setItem(`purchase_tracked_${sessionId}`, 'true');
    }
  }
}, [orderDetails, sessionId]);
```

---

## 4. GTM ã§ã®ã‚¿ã‚°è¨­å®š

### 4.1 å¤‰æ•°ã®è¨­å®š

#### ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼å¤‰æ•°

| å¤‰æ•°å | å¤‰æ•°ã‚¿ã‚¤ãƒ— | ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¤‰æ•°å |
|-------|-----------|---------------------|
| DLV - ecommerce | ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¤‰æ•° | ecommerce |
| DLV - ecommerce.items | ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¤‰æ•° | ecommerce.items |
| DLV - ecommerce.value | ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¤‰æ•° | ecommerce.value |
| DLV - ecommerce.transaction_id | ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¤‰æ•° | ecommerce.transaction_id |
| DLV - user_id | ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¤‰æ•° | user_id |
| DLV - user_type | ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¤‰æ•° | user_type |

### 4.2 ãƒˆãƒªã‚¬ãƒ¼ã®è¨­å®š

| ãƒˆãƒªã‚¬ãƒ¼å | ãƒˆãƒªã‚¬ãƒ¼ã‚¿ã‚¤ãƒ— | æ¡ä»¶ |
|-----------|--------------|------|
| Event - view_item_list | ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ | Event equals view_item_list |
| Event - view_item | ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ | Event equals view_item |
| Event - select_item | ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ | Event equals select_item |
| Event - add_to_cart | ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ | Event equals add_to_cart |
| Event - remove_from_cart | ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ | Event equals remove_from_cart |
| Event - view_cart | ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ | Event equals view_cart |
| Event - begin_checkout | ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ | Event equals begin_checkout |
| Event - add_shipping_info | ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ | Event equals add_shipping_info |
| Event - add_payment_info | ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ | Event equals add_payment_info |
| Event - purchase | ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ | Event equals purchase |
| Event - login | ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ | Event equals login |
| Event - sign_up | ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ | Event equals sign_up |
| Event - search | ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ | Event equals search |
| Event - generate_lead | ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ | Event equals generate_lead |

### 4.3 ã‚¿ã‚°ã®è¨­å®š

#### GA4 è¨­å®šã‚¿ã‚°

| è¨­å®šé …ç›® | å€¤ |
|---------|-----|
| ã‚¿ã‚°å | GA4 - Configuration |
| ã‚¿ã‚°ã‚¿ã‚¤ãƒ— | Google ã‚¿ã‚° |
| ã‚¿ã‚° ID | G-801XNRYDSQ |
| ãƒˆãƒªã‚¬ãƒ¼ | All Pages |

#### GA4 Eã‚³ãƒãƒ¼ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚°

å„Eã‚³ãƒãƒ¼ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã«å¯¾ã—ã¦ã‚¿ã‚°ã‚’ä½œæˆï¼š

**ã‚¿ã‚°å**: GA4 Event - view_item_list
| è¨­å®šé …ç›® | å€¤ |
|---------|-----|
| ã‚¿ã‚°ã‚¿ã‚¤ãƒ— | Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹: GA4 ã‚¤ãƒ™ãƒ³ãƒˆ |
| è¨­å®šã‚¿ã‚° | GA4 - Configuration |
| ã‚¤ãƒ™ãƒ³ãƒˆå | view_item_list |
| ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | |
| - items | {{DLV - ecommerce.items}} |
| ãƒˆãƒªã‚¬ãƒ¼ | Event - view_item_list |

**ã‚¿ã‚°å**: GA4 Event - view_item
| è¨­å®šé …ç›® | å€¤ |
|---------|-----|
| ã‚¿ã‚°ã‚¿ã‚¤ãƒ— | Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹: GA4 ã‚¤ãƒ™ãƒ³ãƒˆ |
| è¨­å®šã‚¿ã‚° | GA4 - Configuration |
| ã‚¤ãƒ™ãƒ³ãƒˆå | view_item |
| ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | |
| - currency | JPY |
| - value | {{DLV - ecommerce.value}} |
| - items | {{DLV - ecommerce.items}} |
| ãƒˆãƒªã‚¬ãƒ¼ | Event - view_item |

**ã‚¿ã‚°å**: GA4 Event - add_to_cart
| è¨­å®šé …ç›® | å€¤ |
|---------|-----|
| ã‚¿ã‚°ã‚¿ã‚¤ãƒ— | Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹: GA4 ã‚¤ãƒ™ãƒ³ãƒˆ |
| è¨­å®šã‚¿ã‚° | GA4 - Configuration |
| ã‚¤ãƒ™ãƒ³ãƒˆå | add_to_cart |
| ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | |
| - currency | JPY |
| - value | {{DLV - ecommerce.value}} |
| - items | {{DLV - ecommerce.items}} |
| ãƒˆãƒªã‚¬ãƒ¼ | Event - add_to_cart |

**ã‚¿ã‚°å**: GA4 Event - purchase
| è¨­å®šé …ç›® | å€¤ |
|---------|-----|
| ã‚¿ã‚°ã‚¿ã‚¤ãƒ— | Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹: GA4 ã‚¤ãƒ™ãƒ³ãƒˆ |
| è¨­å®šã‚¿ã‚° | GA4 - Configuration |
| ã‚¤ãƒ™ãƒ³ãƒˆå | purchase |
| ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | |
| - transaction_id | {{DLV - ecommerce.transaction_id}} |
| - currency | JPY |
| - value | {{DLV - ecommerce.value}} |
| - items | {{DLV - ecommerce.items}} |
| ãƒˆãƒªã‚¬ãƒ¼ | Event - purchase |

> ğŸ’¡ ä»–ã®Eã‚³ãƒãƒ¼ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã‚‚åŒæ§˜ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§è¨­å®š

---

## 5. ç®¡ç†ç”»é¢ã®ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°é™¤å¤–

ç®¡ç†è€…ãƒšãƒ¼ã‚¸ã®ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚’é™¤å¤–ã™ã‚‹å ´åˆï¼š

### 5.1 GTM ãƒˆãƒªã‚¬ãƒ¼ã®ä¾‹å¤–è¨­å®š

ã€ŒAll Pagesã€ãƒˆãƒªã‚¬ãƒ¼ã«ä¾‹å¤–ã‚’è¿½åŠ ï¼š

```
Page Path does not match RegEx ^/admin.*
```

### 5.2 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®åˆ¶å¾¡

`src/lib/gtm.ts` ã«è¿½åŠ ï¼š

```typescript
// ç®¡ç†è€…ãƒšãƒ¼ã‚¸ã‹ã©ã†ã‹ã‚’åˆ¤å®š
const isAdminPage = () => {
  return window.location.pathname.startsWith('/admin');
};

// pushToDataLayerã‚’ä¿®æ­£
export const pushToDataLayer = (data: Record<string, any>) => {
  // ç®¡ç†è€…ãƒšãƒ¼ã‚¸ã§ã¯ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã—ãªã„
  if (isAdminPage()) {
    console.log('[GTM] Skipped (admin page):', data);
    return;
  }
  
  window.dataLayer = window.dataLayer || [];
  window.dataLayer.push(data);
};
```

---

## 6. ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒãƒƒã‚°

### 6.1 GTM ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰

1. GTM ç®¡ç†ç”»é¢ã§ã€Œãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ã‚µã‚¤ãƒˆURLã‚’å…¥åŠ›ã—ã¦æ¥ç¶š
3. å„ãƒšãƒ¼ã‚¸ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚¿ã‚°ã®ç™ºç«ã‚’ç¢ºèª

### 6.2 GA4 ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¬ãƒãƒ¼ãƒˆ

1. GA4 ç®¡ç†ç”»é¢ â†’ ãƒ¬ãƒãƒ¼ãƒˆ â†’ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ 
2. ã‚¤ãƒ™ãƒ³ãƒˆãŒæ­£ã—ãè¨ˆæ¸¬ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### 6.3 Chrome DevTools ã§ã®ç¢ºèª

```javascript
// ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§dataLayerã‚’ç¢ºèª
console.log(window.dataLayer);

// ç‰¹å®šã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿
window.dataLayer.filter(e => e.event === 'purchase');
```

### 6.4 GA4 DebugView

1. GA4 ç®¡ç†ç”»é¢ â†’ ç®¡ç† â†’ DebugView
2. Chromeæ‹¡å¼µã€ŒGoogle Analytics Debuggerã€ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
3. æ‹¡å¼µã‚’æœ‰åŠ¹ã«ã—ã¦ã‚µã‚¤ãƒˆã‚’æ“ä½œ
4. DebugViewã§ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç¢ºèª

---

## 7. ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®š

### 7.1 GA4 ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®š

GA4 ç®¡ç†ç”»é¢ â†’ ç®¡ç† â†’ ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ ã§ä»¥ä¸‹ã‚’è¨­å®šï¼š

| ã‚¤ãƒ™ãƒ³ãƒˆå | ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
|-----------|--------------|
| purchase | âœ… |
| generate_lead | âœ… |
| sign_up | âœ… |
| add_to_cart | ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ |
| begin_checkout | ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ |

### 7.2 ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³è¨­å®š

GA4 ç®¡ç†ç”»é¢ â†’ ç®¡ç† â†’ ã‚«ã‚¹ã‚¿ãƒ å®šç¾©ï¼š

| ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³å | ã‚¹ã‚³ãƒ¼ãƒ— | ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ |
|-----------------|---------|------------------|
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ— | ãƒ¦ãƒ¼ã‚¶ãƒ¼ | user_type |
| å•†å“ã‚«ãƒ†ã‚´ãƒª | ã‚¤ãƒ™ãƒ³ãƒˆ | item_category |
| å•†å“ãƒãƒªã‚¢ãƒ³ãƒˆ | ã‚¤ãƒ™ãƒ³ãƒˆ | item_variant |

---

## 8. å°†æ¥ã®æ‹¡å¼µï¼ˆGoogle Adsé€£æºï¼‰

### 8.1 ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒªãƒ³ã‚«ãƒ¼

GTMã§è¨­å®šï¼š

| è¨­å®šé …ç›® | å€¤ |
|---------|-----|
| ã‚¿ã‚°å | Conversion Linker |
| ã‚¿ã‚°ã‚¿ã‚¤ãƒ— | ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒªãƒ³ã‚«ãƒ¼ |
| ãƒˆãƒªã‚¬ãƒ¼ | All Pages |

### 8.2 Google Ads ãƒªãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ã‚¿ã‚°

| è¨­å®šé …ç›® | å€¤ |
|---------|-----|
| ã‚¿ã‚°å | Google Ads - Remarketing |
| ã‚¿ã‚°ã‚¿ã‚¤ãƒ— | Google åºƒå‘Šã®ãƒªãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚° |
| ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ID | AW-XXXXXXXXXX |
| ãƒˆãƒªã‚¬ãƒ¼ | All Pages |

### 8.3 Google Ads ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°

| è¨­å®šé …ç›® | å€¤ |
|---------|-----|
| ã‚¿ã‚°å | Google Ads - Purchase Conversion |
| ã‚¿ã‚°ã‚¿ã‚¤ãƒ— | Google åºƒå‘Šã®ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° |
| ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ID | AW-XXXXXXXXXX |
| ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ©ãƒ™ãƒ« | XXXXXXXXXX |
| ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³å€¤ | {{DLV - ecommerce.value}} |
| é€šè²¨ã‚³ãƒ¼ãƒ‰ | JPY |
| ãƒˆãƒªã‚¬ãƒ¼ | Event - purchase |

---

## 9. å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### 9.1 GA4 è¨­å®š

- [ ] GA4 ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä½œæˆ
- [ ] æ¸¬å®šIDå–å¾—ï¼ˆG-XXXXXXXXXXï¼‰
- [ ] æ‹¡å¼µè¨ˆæ¸¬æ©Ÿèƒ½ã®æœ‰åŠ¹åŒ–
- [ ] ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®š
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³è¨­å®š

### 9.2 GTM è¨­å®š

- [ ] GTM ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ
- [ ] ã‚³ãƒ³ãƒ†ãƒŠIDå–å¾—ï¼ˆGTM-XXXXXXXï¼‰
- [ ] `index.html` ã«GTMã‚¹ãƒ‹ãƒšãƒƒãƒˆè¿½åŠ 
- [ ] å¤‰æ•°ã®è¨­å®š
- [ ] ãƒˆãƒªã‚¬ãƒ¼ã®è¨­å®š
- [ ] ã‚¿ã‚°ã®è¨­å®š

### 9.3 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

- [ ] å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®è¿½åŠ 
- [ ] GTMãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ä½œæˆ
- [ ] å•†å“ä¸€è¦§ãƒšãƒ¼ã‚¸ã¸ã®å®Ÿè£…
- [ ] å•†å“è©³ç´°ãƒšãƒ¼ã‚¸ã¸ã®å®Ÿè£…
- [ ] ã‚«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã¸ã®å®Ÿè£…
- [ ] è³¼å…¥å®Œäº†ãƒšãƒ¼ã‚¸ã¸ã®å®Ÿè£…
- [ ] ãƒ­ã‚°ã‚¤ãƒ³/ä¼šå“¡ç™»éŒ²ã®ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
- [ ] ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°

### 9.4 ãƒ†ã‚¹ãƒˆ

- [ ] GTMãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã§ã®ç¢ºèª
- [ ] GA4 ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¬ãƒãƒ¼ãƒˆã§ã®ç¢ºèª
- [ ] å…¨Eã‚³ãƒãƒ¼ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã®å‹•ä½œç¢ºèª
- [ ] ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®è¨ˆæ¸¬ç¢ºèª

---

## 10. ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†

### 10.1 é–‹ç™ºç’°å¢ƒãƒ»æœ¬ç•ªç’°å¢ƒã®åˆ†é›¢

`.env.development`:
```bash
VITE_GTM_ID=GTM-XXXXXXX  # ãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒ³ãƒ†ãƒŠ
```

`.env.production`:
```bash
VITE_GTM_ID=GTM-XXXXXXX  # æœ¬ç•ªç”¨ã‚³ãƒ³ãƒ†ãƒŠ
```

### 10.2 å‹•çš„ãªGTMã‚¹ãƒ‹ãƒšãƒƒãƒˆ

`index.html` ã‚’ä¿®æ­£ã™ã‚‹ã‹ã€Reactå†…ã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å‹•çš„ã«æŒ¿å…¥ï¼š

```typescript
// src/lib/gtm-init.ts
export const initGTM = (gtmId: string) => {
  if (!gtmId) return;
  
  // Head script
  const script = document.createElement('script');
  script.innerHTML = `
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','${gtmId}');
  `;
  document.head.appendChild(script);

  // Body noscript
  const noscript = document.createElement('noscript');
  noscript.innerHTML = `<iframe src="https://www.googletagmanager.com/ns.html?id=${gtmId}"
    height="0" width="0" style="display:none;visibility:hidden"></iframe>`;
  document.body.insertBefore(noscript, document.body.firstChild);
};
```

`src/main.tsx`:
```typescript
import { initGTM } from './lib/gtm-init';

// GTMåˆæœŸåŒ–
initGTM(import.meta.env.VITE_GTM_ID);
```

---

## 11. å‚è€ƒãƒªãƒ³ã‚¯

- [Google Analytics 4 å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://developers.google.com/analytics/devguides/collection/ga4)
- [Google Tag Manager å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://developers.google.com/tag-manager)
- [GA4 Eã‚³ãƒãƒ¼ã‚¹å®Ÿè£…ã‚¬ã‚¤ãƒ‰](https://developers.google.com/analytics/devguides/collection/ga4/ecommerce)
- [GA4 æ¨å¥¨ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§](https://support.google.com/analytics/answer/9267735)
- [GTM ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰](https://support.google.com/tagmanager/answer/6107056)

---

## 12. å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| ãƒ•ã‚§ãƒ¼ã‚º | ä½œæ¥­å†…å®¹ | æ‰€è¦æ™‚é–“ |
|---------|---------|---------|
| 1 | GA4ãƒ»GTM ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š | 30åˆ† |
| 2 | GTMã‚¹ãƒ‹ãƒšãƒƒãƒˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« | 15åˆ† |
| 3 | åŸºæœ¬ã‚¿ã‚°ãƒ»ãƒˆãƒªã‚¬ãƒ¼è¨­å®š | 1æ™‚é–“ |
| 4 | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰GTMå®Ÿè£… | 2-3æ™‚é–“ |
| 5 | Eã‚³ãƒãƒ¼ã‚¹ã‚¿ã‚°è¨­å®š | 1æ™‚é–“ |
| 6 | ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒãƒƒã‚° | 1-2æ™‚é–“ |
| 7 | ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®š | 30åˆ† |

**åˆè¨ˆ: ç´„1æ—¥**

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç¢ºèªå¾Œã€ä»¥ä¸‹ã®é †åºã§å®Ÿè£…ã‚’é€²ã‚ã¾ã™ï¼š

1. GA4 ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ä½œæˆã¨è¨­å®š
2. GTM ã‚³ãƒ³ãƒ†ãƒŠã®ä½œæˆ
3. `index.html` ã¸ã®GTMã‚¹ãƒ‹ãƒšãƒƒãƒˆè¿½åŠ 
4. `src/lib/gtm.ts` ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ä½œæˆ
5. å„ãƒšãƒ¼ã‚¸ã¸ã®ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚³ãƒ¼ãƒ‰è¿½åŠ 
6. GTMç®¡ç†ç”»é¢ã§ã®ã‚¿ã‚°ãƒ»ãƒˆãƒªã‚¬ãƒ¼è¨­å®š
7. ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®å‹•ä½œç¢ºèª
8. æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

å®Ÿè£…ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ

